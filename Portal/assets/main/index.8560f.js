window.__require=function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)r(o[a]);return r}({AuthService:[function(e,t,n){"use strict";cc._RF.push(t,"f948aW0QKBDb5F6NBu6ynCi","AuthService");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.AuthService=void 0;var i=e("../constants/StorageKeys"),a=e("./PortalContextService"),s=function(){function e(){}return e.isPortalOrigin=function(){var e;if("undefined"==typeof window||!(null===(e=window.location)||void 0===e?void 0:e.hostname))return!1;var t=window.location.hostname;return t.includes("c6-portal-dev")||t.includes("c6gamestag.win")||t.includes("6112.stgame.win")},e.getApiBase=function(){return this.isPortalOrigin()?"":this.API_BASE},e.getRegisterUrl=function(){var e=this.getApiBase();return e?e+"/user/register.aspx":"/api/user/register.aspx"},e.getLoginUrl=function(){var e=this.getApiBase();return e?e+"/user/login.aspx":"/api/user/login.aspx"},e.getChangeDisplayNameUrl=function(){var e=this.getApiBase();return e?e+"/gwms/v1/u/change/displayname.aspx":"/api/gwms/v1/u/change/displayname.aspx"},e.getLogoutUrl=function(){var e=this.getApiBase();return e?e+"/user/logout.aspx":"/api/user/logout.aspx"},e.signUp=function(e,t){return o(this,void 0,Promise,function(){var n,o;return r(this,function(r){switch(r.label){case 0:return n=this.randomHex(32),o=this.buildRegisterPayload(e,t,n),[4,this.postPlainJson(this.getRegisterUrl(),o)];case 1:return r.sent(),[2,{token:"",username:e}]}})})},e.signIn=function(e,t){return o(this,void 0,Promise,function(){var n,o,i,a,s,c;return r(this,function(r){switch(r.label){case 0:return[4,this.getFingerprint()];case 1:return n=r.sent(),o=this.buildLoginPayload(e,t,n),[4,this.postPlainJson(this.getLoginUrl(),o)];case 2:if(i=r.sent(),"undefined"!=typeof cc&&cc.log?cc.log("[AuthService] Login response:",i):console.log("[AuthService] Login response:",i),this._lastLoginData=i,this.saveProfileCacheFromLogin(i),!(a=this.extractToken(i)))throw s=this.extractErrorMessage(i)||"Login failed: token missing (check credentials)",new Error(s);return c=this.extractSessionId(i)||a,this.saveCurrentUser(e,a,c),[2,{token:a,username:e}]}})})},e.getCachedProfile=function(){return this.loadProfileCache()},e.updateCachedFullname=function(e){var t=this.loadProfileCache();if(t){t.fullname=e;var n=this.getStorage();n&&n.setItem(i.StorageKeys.AUTH_PROFILE,JSON.stringify(t))}},e.saveProfileCacheFromLogin=function(e){var t=this.extractProfileFromLogin(e);if(t){var n=this.getStorage();n&&n.setItem(i.StorageKeys.AUTH_PROFILE,JSON.stringify(t))}},e.loadProfileCache=function(){var e=this.getStorage();if(!e)return null;var t=e.getItem(i.StorageKeys.AUTH_PROFILE);if(!t)return null;try{return JSON.parse(t)}catch(n){return null}},e.extractProfileFromLogin=function(e){if(!e)return null;var t=e.data||e.Data||e,n=Array.isArray(t)?t[0]:t;return n?{uid:n.uid||n.uuid||n.id,fullname:n.fullname,main_balance:n.main_balance,status:e.status||e.message,raw:e}:null},e.changeDisplayName=function(e,t,n){return o(this,void 0,Promise,function(){var o,i,a,s,c;return r(this,function(r){switch(r.label){case 0:return o={fullname:t,lang:n||this.getLang()},i=this.getChangeDisplayNameUrl(),a={accept:"*/*","content-type":"application/json","X-Token":e},"undefined"!=typeof cc&&cc.log&&(cc.log("[AuthService] changeDisplayName url:",i),cc.log("[AuthService] changeDisplayName X-Token (session_id):",e?"(set)":"(missing)"),cc.log("[AuthService] changeDisplayName payload:",JSON.stringify(o))),[4,fetch(i,{method:"POST",headers:a,body:JSON.stringify(o)})];case 1:return s=r.sent(),[4,this.parseResponse(s)];case 2:return c=r.sent(),"undefined"!=typeof cc&&cc.log&&cc.log("[AuthService] changeDisplayName response:",c),[2]}})})},e.logout=function(e){return o(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,this.postPlainJson(this.getLogoutUrl(),{},{"x-token":e,"content-type":"application/json"})];case 1:return t.sent(),this.clearCurrentUser(),[2]}})})},e.buildLoginPayload=function(e,t,n){var o=this.getDeviceInfo(),r=Math.floor(Date.now()/1e3),i=this.computeSign(e,t,r);return{username:e,password:t,app_id:this.getAppId(),os:o.os,device:o.device,browser:o.browser,fg:n,time:r,sign:i,version:this.DEFAULTS.version,lang:this.getLang(),csrf:"",aff_id:this.DEFAULTS.affId}},e.buildRegisterPayload=function(e,t,n){var o=this.getDeviceInfo(),r=Math.floor(Date.now()/1e3),i=this.computeSign(e,t,r);return{fullname:e,username:e,password:t,app_id:this.getAppId(),avatar:this.DEFAULTS.avatar,os:o.os,device:o.device,browser:o.browser,fg:n,time:r,sign:i,aff_id:this.DEFAULTS.affId,lang:this.getLang(),csrf:"",ref_id:"",version:this.DEFAULTS.version}},e.getBaseHeaders=function(){return{"content-type":"text/plain;charset=UTF-8",origin:"https://6112.stgame.win",referer:"https://6112.stgame.win/",accept:"*/*","accept-language":"en-US,en;q=0.9,vi;q=0.8"}},e.postPlainJson=function(e,t,n){return o(this,void 0,Promise,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,fetch(e,{method:"POST",headers:this.mergeHeaders(this.getBaseHeaders(),n),body:JSON.stringify(t)})];case 1:return o=r.sent(),[2,this.parseResponse(o)]}})})},e.postJson=function(e,t,n){return o(this,void 0,Promise,function(){var o;return r(this,function(r){switch(r.label){case 0:return[4,fetch(e,{method:"POST",headers:this.mergeHeaders({"content-type":"application/json"},n),body:JSON.stringify(t)})];case 1:return o=r.sent(),[2,this.parseResponse(o)]}})})},e.getJson=function(e,t){return o(this,void 0,Promise,function(){var n;return r(this,function(o){switch(o.label){case 0:return[4,fetch(e,{method:"GET",headers:this.mergeHeaders({},t)})];case 1:return n=o.sent(),[2,this.parseResponse(n)]}})})},e.parseResponse=function(e){return o(this,void 0,Promise,function(){var t,n,o;return r(this,function(r){switch(r.label){case 0:return[4,e.text()];case 1:t=r.sent(),n=null;try{n=t?JSON.parse(t):null}catch(i){n={raw:t}}if(!e.ok)throw o=this.extractErrorMessage(n)||"HTTP "+e.status,new Error(o);return[2,n]}})})},e.extractToken=function(e){if(!e)return"";var t=e.Token||e.token||e.session||e.sessionId||e.session_id;if(t)return t;var n=e.data||e.Data||e;if("string"==typeof n)try{n=JSON.parse(n)}catch(r){}if(Array.isArray(n)&&n.length>0){var o=n[0];return o.Token||o.token||o.session||o.sessionId||o.session_id||""}return n&&"object"==typeof n&&(n.Token||n.token||n.session||n.sessionId||n.session_id)||""},e.extractSessionId=function(e){if(!e)return"";var t=e.session_id||e.sessionId||e.session;if(t)return t;var n=e.data||e.Data||e;if("string"==typeof n)try{n=JSON.parse(n)}catch(r){}if(Array.isArray(n)&&n.length>0){var o=n[0];return o.session_id||o.sessionId||o.session||""}return n&&"object"==typeof n&&(n.session_id||n.sessionId||n.session)||""},e.extractErrorMessage=function(e){return e&&(e.message||e.msg||e.error||e.err_msg||e.StatusMessage||e.data&&(e.data.message||e.data.msg||e.data.error||e.data.err_msg))||""},e.getDeviceInfo=function(){var e="unknown",t="unknown",n="Computer";return"undefined"!=typeof cc&&cc.sys?(e=cc.sys.os||e,t=cc.sys.browserType||t,n=cc.sys.isMobile?"Mobile":"Computer"):"undefined"!=typeof navigator&&(e=navigator.platform||e,t=navigator.userAgent||t),"OSX"===e&&(e="OS X"),{os:e,device:n,browser:t}},e.computeSign=function(){return"2ce4bd4ae64077d7d01e3a7b6fcec37a"},e.getFingerprint=function(){var e=this.getStorage();if(!e)return this.randomHex(32);var t=e.getItem(i.StorageKeys.AUTH_FINGERPRINT);return t||(t=this.randomHex(32),e.setItem(i.StorageKeys.AUTH_FINGERPRINT,t)),t},e.randomHex=function(e){for(var t="",n=0;n<e;n+=1)t+=Math.floor(16*Math.random()).toString(16);return t},e.getAppId=function(){return a.PortalContextService.getAppId&&a.PortalContextService.getAppId()||this.DEFAULTS.appId},e.getLang=function(){return a.PortalContextService.getLanguage&&a.PortalContextService.getLanguage()||"en"},e.getLangForApi=function(){return"VN"===(a.PortalContextService.getMarket&&a.PortalContextService.getMarket())?"vn":"th"===this.getLang()?"th":"en"},e.mergeHeaders=function(e,t){var n={};return Object.keys(e||{}).forEach(function(t){n[t]=e[t]}),Object.keys(t||{}).forEach(function(e){n[e]=t[e]}),n},e.saveCurrentUser=function(e,t,n){var o=this.getStorage();o&&(o.setItem(i.StorageKeys.AUTH_USER,e),o.setItem(i.StorageKeys.USER_TOKEN,t),n&&o.setItem(i.StorageKeys.USER_SESSION_ID,n))},e.clearCurrentUser=function(){var e=this.getStorage();e&&(e.removeItem(i.StorageKeys.AUTH_USER),e.removeItem(i.StorageKeys.USER_TOKEN),e.removeItem(i.StorageKeys.USER_SESSION_ID))},e.getStorage=function(){return"undefined"==typeof localStorage?null:localStorage},e.API_BASE="https://apigw-111.sgame.us",e.DEFAULTS={appId:"bc668002",affId:"bc668002",avatar:"Avatar8",version:"0.0.30"},e._lastLoginData=null,e}();n.AuthService=s,cc._RF.pop()},{"../constants/StorageKeys":"StorageKeys","./PortalContextService":"PortalContextService"}],ConfigService:[function(e,t,n){"use strict";cc._RF.push(t,"f9197nNFvZMFL/aDLUfBU6M","ConfigService");var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigService=void 0;var i=e("../core/PortalContextService"),a=e("../constants/Config"),s=function(){function e(){}return e.loadConfig=function(){return o(this,void 0,Promise,function(){var e,t,n,o,s;return r(this,function(r){switch(r.label){case 0:e=i.PortalContextService.getEnvironment(),console.log("[ConfigService] Current env:",e),t=this.getBaseUrl(e)+"/"+a.GAMES_CONFIG_FILENAME,console.log("[ConfigService] Fetching config from:",t),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,fetch(t,{cache:"no-store"})];case 2:if(!(n=r.sent()).ok)throw new Error("Config HTTP "+n.status+" ("+t+")");return[4,n.json()];case 3:return(o=r.sent()).env!==e&&console.warn("[ConfigService] Env mismatch: expected "+e+", got "+o.env),this._cache=o,console.log("[ConfigService] Config loaded",o),[2,o];case 4:throw s=r.sent(),console.error("[ConfigService] Failed to load config",s),s;case 5:return[2]}})})},e.getSlots=function(){return this._cache?this._cache.slots:[]},e.clearCache=function(){this._cache=null},e.getBaseUrl=function(e){return a.getPortalConfigsBaseUrl(e)},e._cache=null,e}();n.ConfigService=s,cc._RF.pop()},{"../constants/Config":"Config","../core/PortalContextService":"PortalContextService"}],Config:[function(e,t,n){"use strict";function o(e){return"c6-assets-"+e+".c6gamestag.win"}cc._RF.push(t,"d0d13eja9pMGaKd2uTxklbZ","Config"),Object.defineProperty(n,"__esModule",{value:!0}),n.getPortalConfigsBaseUrl=n.GAMES_CONFIG_FILENAME=n.PORTAL_CONFIGS_PATH=n.CDN_BASE_URL=void 0,n.CDN_BASE_URL="__CDN_BASE_URL__",n.PORTAL_CONFIGS_PATH="/portal-configs",n.GAMES_CONFIG_FILENAME="games-config.json",n.getPortalConfigsBaseUrl=function(e){var t="https://"+o(e)+n.PORTAL_CONFIGS_PATH;if("undefined"!=typeof window&&window.location&&window.location.origin){var r=window.location.hostname;return"localhost"===r||"127.0.0.1"===r?t:""+window.location.origin+n.PORTAL_CONFIGS_PATH}return""+("__CDN_BASE_URL__"===n.CDN_BASE_URL?"https://"+o("dev"):n.CDN_BASE_URL)+n.PORTAL_CONFIGS_PATH},cc._RF.pop()},{}],EventBridge:[function(e,t,n){"use strict";cc._RF.push(t,"95fe9h/G7ZJh4aV4QiqZVPZ","EventBridge");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var r=e("./RemoteBundleLoader"),i=e("./PortalContextService"),a=e("../constants/PortalEvents"),s=cc._decorator.ccclass,c=function(){function e(){}return e.installGameApiFetchProxy=function(){if(!this._fetchProxyInstalled&&"undefined"!=typeof fetch){this._fetchProxyInstalled=!0;var e=("undefined"!=typeof window&&window.location&&window.location.origin?window.location.origin:"")+"/game",t=fetch.bind("undefined"!=typeof globalThis?globalThis:window),n=function(t){if(!t||"string"!=typeof t)return t;var n=t.trim();if(n.startsWith("https://c6-api-dev.c6gamestag.win/game")){var o=n.slice("https://c6-api-dev.c6gamestag.win/game".length).replace(/^\/*/,"")||"";return o?e+"/"+o:e+"/"}return t};("undefined"!=typeof globalThis?globalThis:window).fetch=function(e,o){var r;return"string"==typeof e?(r=n(e),t(r,o)):e instanceof Request?(r=n(e.url))===e.url?t(e):t(new Request(r,e)):(r=n(e.href),t(r,o))},"undefined"!=typeof cc&&cc.log&&cc.log("[EventBridge] Game API fetch proxy installed: ","https://c6-api-dev.c6gamestag.win/game"," -> ",e)}},e.init=function(){this._initialized?cc.warn("[EventBridge] Already initialized"):(this._initialized=!0,cc.director.on(a.PortalEvents.PORTAL_LAUNCH_GAME,this.onLaunchGame,this),cc.director.on(a.PortalEvents.BACK_TO_LOBBY,this.onBackToLobby,this),cc.director.on(a.PortalEvents.SHOW_POPUP,this.onShowPopup,this),cc.director.on(a.PortalEvents.UPDATE_SFX,this.onUpdateSfx,this),cc.log("[EventBridge] Initialized"))},e.onLaunchGame=function(e){var t,n=this;if(i.PortalContextService.getToken()){cc.log("[EventBridge] Launch game:",e.game_id||e.gameId);var o=null===(t=cc.find("Canvas/LobbyRoot"))||void 0===t?void 0:t.getComponent("LobbyUIController");o&&o.disableAllCards(),cc.director.loadScene("GameHostScene",function(){var t=cc.find("Canvas/GameHostUIController").getComponent("GameHostUIController");if(t.showLoading(),!e.bundle)return cc.error("[EventBridge] Game Bundle URL is missing for",e.game_id),t.hideLoading(),void cc.director.loadScene("LobbyScene");("undefined"!=typeof globalThis?globalThis:window).__PORTAL_GAME_API_BASE__=i.PortalContextService.getGameApiBaseUrl(),n.installGameApiFetchProxy();var o=e.entryScene;if(o&&"string"==typeof o){var a=o.trim();o=""===a||"_map"===a?void 0:a.startsWith("[entryScene]")?a.slice("[entryScene]".length).trim()||void 0:a}r.default.loadGame(e.bundle,t.gameRoot,function(e,n){var o=n>0?e/n:0;t.setLoadingProgress(o)},function(e){return t.setLoadingText(e)},o).then(function(){"prefab"===r.default.mode&&t.hideLoading()}).catch(function(e){cc.error("[EventBridge] Load failed",e),cc.director.loadScene("LobbyScene")})})}else{cc.log("[EventBridge] User not logged in. Opening Sign In panel.");var a=cc.find("Canvas/LobbyRoot");if(a){var s=a.getComponent("LobbyUIController");s&&s.onClickOpenSignIn&&s.onClickOpenSignIn()}}},e.onBackToLobby=function(){cc.log("[EventBridge] Back to Lobby"),r.default.unloadGame(),cc.director.loadScene("LobbyScene")},e.onShowPopup=function(e){cc.log("[EventBridge] Show popup:",e)},e.onUpdateSfx=function(e){cc.log("[EventBridge] Update SFX:",e.enableSound),i.PortalContextService.setSoundEnabled(e.enableSound)},e._initialized=!1,e._fetchProxyInstalled=!1,o([s],e)}();n.default=c,cc._RF.pop()},{"../constants/PortalEvents":"PortalEvents","./PortalContextService":"PortalContextService","./RemoteBundleLoader":"RemoteBundleLoader"}],GameCardController:[function(e,t,n){"use strict";cc._RF.push(t,"a2054NtjxtESZ0MoW9raUFl","GameCardController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../constants/PortalEvents"),s=cc._decorator,c=s.ccclass,l=(s.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.button=null,t._gameData=null,t}return r(t,e),t.prototype.onLoad=function(){this.button=this.getComponent(cc.Button)},t.prototype.init=function(e){this._gameData=e,this.setInteractable(!0)},t.prototype.onClick=function(){this._gameData&&(cc.log("[GameCardController] onClick",this._gameData.game_id,this._gameData.bundle),cc.director.emit(a.PortalEvents.PORTAL_LAUNCH_GAME,this._gameData))},t.prototype.setInteractable=function(e){this.button&&(this.button.interactable=e)},t.prototype.reset=function(){this._gameData=null,this.setInteractable(!0)},i([c],t)}(cc.Component));n.default=l,cc._RF.pop()},{"../constants/PortalEvents":"PortalEvents"}],GameEntry:[function(e,t,n){"use strict";cc._RF.push(t,"45ca5VlxANK2oasrmYAQarF","GameEntry");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator.ccclass,s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onLoad=function(){this.readRuntimeContext()},t.prototype.readRuntimeContext=function(){var e=localStorage.getItem("user_token"),t=localStorage.getItem("appLanguage"),n=localStorage.getItem("enableSound");cc.log("[GameEntry] Context:",{token:e,lang:t,sound:n})},t.prototype.onExitGame=function(){cc.director.emit("INTEGRATION_BACK_TO_LOBBY")},t.prototype.onToggleSound=function(e){cc.director.emit("UPDATE_SFX_SETTING",{enableSound:e})},i([a],t)}(cc.Component);n.default=s,cc._RF.pop()},{}],GameHostUIController:[function(e,t,n){"use strict";cc._RF.push(t,"6ebf1Z+luBPIIbLckgL4AXy","GameHostUIController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../constants/PortalEvents"),s=cc._decorator,c=s.ccclass,l=s.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameRoot=null,t.loadingNode=null,t.loadingBarSprite=null,t.loadingLabel=null,t}return r(t,e),t.prototype.onLoad=function(){this.gameRoot&&this.gameRoot.removeAllChildren(),this.loadingNode&&(this.loadingNode.active=!1,this.loadingBarSprite&&(this.loadingBarSprite.type=cc.Sprite.Type.FILLED,this.loadingBarSprite.fillType=cc.Sprite.FillType.HORIZONTAL,this.loadingBarSprite.fillStart=0,this.loadingBarSprite.fillRange=0))},t.prototype.onBackToLobby=function(){cc.director.emit(a.PortalEvents.BACK_TO_LOBBY)},t.prototype.showLoading=function(){this.loadingNode&&(this.loadingNode.active=!0,this.setLoadingProgress(0),this.setLoadingText("Downloading..."))},t.prototype.hideLoading=function(){this.loadingNode&&(this.loadingNode.active=!1)},t.prototype.setLoadingProgress=function(e){this.loadingBarSprite&&(this.loadingBarSprite.fillRange=Math.max(0,Math.min(1,e)))},t.prototype.setLoadingText=function(e){this.loadingLabel&&(this.loadingLabel.string=e)},t.prototype.onDestroy=function(){this.gameRoot&&this.gameRoot.removeAllChildren()},i([l(cc.Node)],t.prototype,"gameRoot",void 0),i([l(cc.Node)],t.prototype,"loadingNode",void 0),i([l(cc.Sprite)],t.prototype,"loadingBarSprite",void 0),i([l(cc.Label)],t.prototype,"loadingLabel",void 0),i([c],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../constants/PortalEvents":"PortalEvents"}],LobbyUIController:[function(e,t,n){"use strict";cc._RF.push(t,"620366/8RxIEKHvJ5RtNXzB","LobbyUIController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{c(o.next(e))}catch(t){i(t)}}function s(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return c([e,t])}}function c(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var c=cc._decorator,l=c.ccclass,u=c.property,d=e("../core/ConfigService"),g=e("../core/PortalContextService"),f=e("../core/EventBridge"),h=e("../game/GameCardController"),p=e("../core/AuthService"),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameListContent=null,t.gameCardPrefab=null,t.errorPanel=null,t.signInPanel=null,t.signUpPanel=null,t.signInButton=null,t.signUpButton=null,t.signInSubmitButton=null,t.signUpSubmitButton=null,t.signInCloseButton=null,t.signUpCloseButton=null,t.authGuestPanel=null,t.authUserPanel=null,t.lblProfileName=null,t.lblProfileBalance=null,t.logoutButton=null,t.nameChangePanel=null,t.nameChangeInput=null,t.nameChangeSubmitButton=null,t.nameChangeErrorLabel=null,t.signInUsername=null,t.signInPassword=null,t.signUpUsername=null,t.signUpPassword=null,t.signUpPasswordRe=null,t.signInShowPass=null,t.signUpShowPass=null,t.signUpShowPassRe=null,t._errorLabel=null,t._profileLoaded=!1,t._cardPool=new cc.NodePool,t._gameList=[],t}return r(t,e),t.prototype.onLoad=function(){g.PortalContextService.init(),f.default.init(),this.initAuthUi(),this.loadGameList(),this.updateAuthGate(),this.loadUserProfileIfNeeded()},t.prototype.onDestroy=function(){this._cardPool.clear()},t.prototype.loadGameList=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,d.ConfigService.loadConfig()];case 1:return e=n.sent(),this._gameList=e.slots||[],this.renderGames(this._gameList),[3,3];case 2:return t=n.sent(),cc.error("[Lobby] Failed to load config",t),this.showError("Failed to load game list"),[3,3];case 3:return[2]}})})},t.prototype.renderGames=function(e){var t=this;this.clearGameList(),e&&0!==e.length?(e.forEach(function(e){var n=t.getCardFromPool();n.parent=t.gameListContent,t.loadThumbnail(n,e.thumbnail),n.getChildByName("lblGameName").getComponent(cc.Label).string=e.name,n.getChildByName("lblGameDesc").getComponent(cc.Label).string=e.description,n.getComponent(h.default).init(e)}),this.updateAuthGate()):this.showError("No games available")},t.prototype.loadThumbnail=function(e,t){var n=e.getChildByName("Mask").getChildByName("Thumbnail").getComponent(cc.Sprite);cc.assetManager.loadRemote(t,function(e,o){e?cc.warn("Thumbnail load failed:",t):n.spriteFrame=new cc.SpriteFrame(o)})},t.prototype.clearGameList=function(){var e=this;this.gameListContent.children.forEach(function(t){var n=t.getComponent(h.default);n&&n.reset(),e._cardPool.put(t)}),this.gameListContent.removeAllChildren()},t.prototype.showError=function(e){if(void 0===e&&(e="Failed to load game list"),this.errorPanel&&(this.errorPanel.active=!0),!this._errorLabel){var t=this.errorPanel?this.errorPanel.getChildByName("lblError"):null;this._errorLabel=t?t.getComponent(cc.Label):null}this._errorLabel&&(this._errorLabel.string=e),cc.warn("[Lobby]",e)},t.prototype.getCardFromPool=function(){return this._cardPool.size()>0?this._cardPool.get():cc.instantiate(this.gameCardPrefab)},t.prototype.disableAllCards=function(){this.gameListContent.children.forEach(function(e){var t=e.getComponent("GameCardController");t&&t.setInteractable(!1)})},t.prototype.updateAuthGate=function(){var e=!(!g.PortalContextService.getToken||!g.PortalContextService.getToken());this.authGuestPanel&&(this.authGuestPanel.active=!e),this.authUserPanel&&(this.authUserPanel.active=e),this.setCardsInteractable(!0)},t.prototype.setCardsInteractable=function(e){this.gameListContent.children.forEach(function(t){var n=t.getComponent("GameCardController");n&&n.setInteractable(e)})},t.prototype.loadUserProfileIfNeeded=function(e){return void 0===e&&(e=!1),a(this,void 0,void 0,function(){var t;return s(this,function(){return this._profileLoaded&&!e?[2]:g.PortalContextService.getToken&&g.PortalContextService.getToken()&&(t=p.AuthService.getCachedProfile())?(this.lblProfileName&&(this.lblProfileName.string=t.fullname||"User"),this.lblProfileBalance&&"number"==typeof t.main_balance&&(this.lblProfileBalance.string=String(t.main_balance)),this._profileLoaded=!0,[2]):[2]})})},t.prototype.clearProfileUi=function(){this.lblProfileName&&(this.lblProfileName.string=""),this.lblProfileBalance&&(this.lblProfileBalance.string="")},t.prototype.initAuthUi=function(){this.signInShowPass&&this.setPasswordVisible(this.signInPassword,this.signInShowPass.isChecked),this.signUpShowPass&&this.setPasswordVisible(this.signUpPassword,this.signUpShowPass.isChecked),this.signUpShowPassRe&&this.setPasswordVisible(this.signUpPasswordRe,this.signUpShowPassRe.isChecked)},t.prototype.onClickCloseError=function(){this.clearError()},t.prototype.onClickOpenSignIn=function(){this.showPanel(this.signInPanel)},t.prototype.onClickOpenSignUp=function(){this.showPanel(this.signUpPanel)},t.prototype.onClickCloseSignIn=function(){this.hidePanel(this.signInPanel)},t.prototype.onClickCloseSignUp=function(){this.hidePanel(this.signUpPanel)},t.prototype.onToggleSignInShowPass=function(){this.setPasswordVisible(this.signInPassword,!!this.signInShowPass&&this.signInShowPass.isChecked)},t.prototype.onToggleSignUpShowPass=function(){this.setPasswordVisible(this.signUpPassword,!!this.signUpShowPass&&this.signUpShowPass.isChecked)},t.prototype.onToggleSignUpShowPassRe=function(){this.setPasswordVisible(this.signUpPasswordRe,!!this.signUpShowPassRe&&this.signUpShowPassRe.isChecked)},t.prototype.showPanel=function(e){e&&(e===this.signInPanel&&this.signUpPanel&&(this.signUpPanel.active=!1),e===this.signUpPanel&&this.signInPanel&&(this.signInPanel.active=!1),this.clearError(),e.active=!0)},t.prototype.hidePanel=function(e){e&&(e.active=!1,this.clearInputs(e),this.clearError())},t.prototype.clearInputs=function(e){e&&e.getComponentsInChildren(cc.EditBox).forEach(function(e){return e.string=""})},t.prototype.clearError=function(){this.errorPanel&&(this.errorPanel.active=!1)},t.prototype.setPasswordVisible=function(e,t){e&&(e.inputFlag=t?cc.EditBox.InputFlag.DEFAULT:cc.EditBox.InputFlag.PASSWORD,e.string=e.string)},t.prototype.onSignIn=function(){return a(this,void 0,void 0,function(){var e,t,n,o,r;return s(this,function(i){switch(i.label){case 0:if(e=(this.signInUsername&&this.signInUsername.string||"").trim(),t=this.signInPassword?this.signInPassword.string:"",n=this.validateCredentials(e,t))return this.showError(n),[2];this.setAuthButtonsEnabled(!1),i.label=1;case 1:return i.trys.push([1,4,5,6]),[4,p.AuthService.signIn(e,t)];case 2:return o=i.sent(),g.PortalContextService.setToken(o.token),this.hidePanel(this.signInPanel),this.updateAuthGate(),[4,this.loadUserProfileIfNeeded(!0)];case 3:return i.sent(),this.promptNameChangeIfNeeded(),[3,6];case 4:return r=i.sent(),this.showError(r&&r.message?r.message:"Login failed"),[3,6];case 5:return this.setAuthButtonsEnabled(!0),[7];case 6:return[2]}})})},t.prototype.onSignUp=function(){return a(this,void 0,void 0,function(){var e,t,n,o,r;return s(this,function(i){switch(i.label){case 0:if(e=(this.signUpUsername&&this.signUpUsername.string||"").trim(),t=this.signUpPassword?this.signUpPassword.string:"",n=this.signUpPasswordRe?this.signUpPasswordRe.string:"",o=this.validateCredentials(e,t,n))return this.showError(o),[2];this.setAuthButtonsEnabled(!1),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,p.AuthService.signUp(e,t)];case 2:return i.sent(),this.hidePanel(this.signUpPanel),"undefined"!=typeof cc&&cc.log&&cc.log("[Lobby] Sign up successful. Please sign in."),this.updateAuthGate(),[3,5];case 3:return r=i.sent(),this.showError(r&&r.message?r.message:"Sign up failed"),[3,5];case 4:return this.setAuthButtonsEnabled(!0),[7];case 5:return[2]}})})},t.prototype.onLogout=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:if(!(e=g.PortalContextService.getToken&&g.PortalContextService.getToken()))return this.updateAuthGate(),[2];this.setAuthButtonsEnabled(!1),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,p.AuthService.logout(e)];case 2:return n.sent(),[3,5];case 3:return t=n.sent(),g.PortalContextService.setToken(""),this.showError(t&&t.message?t.message:"Logout failed"),[3,5];case 4:return this._profileLoaded=!1,this.clearProfileUi(),this.updateAuthGate(),this.setAuthButtonsEnabled(!0),[7];case 5:return[2]}})})},t.prototype.promptNameChangeIfNeeded=function(){var e=p.AuthService.getCachedProfile();if(e){var t=(e.fullname||"").trim();t&&"_undefined"!==t||this.showNameChangePanel()}},t.prototype.showNameChangePanel=function(){this.nameChangePanel&&(this.nameChangeInput&&(this.nameChangeInput.string=""),this.nameChangeErrorLabel&&(this.nameChangeErrorLabel.string="",this.nameChangeErrorLabel.node.active=!1),this.nameChangePanel.active=!0)},t.prototype.hideNameChangePanel=function(){this.nameChangePanel&&(this.nameChangePanel.active=!1,this.nameChangeInput&&(this.nameChangeInput.string=""),this.nameChangeErrorLabel&&(this.nameChangeErrorLabel.string="",this.nameChangeErrorLabel.node.active=!1))},t.prototype.onChangeDisplayName=function(){return a(this,void 0,void 0,function(){var e,t,n,o;return s(this,function(r){switch(r.label){case 0:if(!(e=(this.nameChangeInput&&this.nameChangeInput.string||"").trim()))return this.showNameChangeError("Please enter a display name"),[2];if(e.length<3)return this.showNameChangeError("Name must be at least 3 characters"),[2];if(e.length>15)return this.showNameChangeError("Name must be at most 15 characters"),[2];if(!(t=g.PortalContextService.getSessionId()||g.PortalContextService.getToken()))return this.showNameChangeError("Not logged in"),[2];this.nameChangeSubmitButton&&(this.nameChangeSubmitButton.interactable=!1),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,p.AuthService.changeDisplayName(t,e)];case 2:return r.sent(),p.AuthService.updateCachedFullname(e),this.lblProfileName&&(this.lblProfileName.string=e),cc.log("[Lobby] Display name changed to:",e),this.hideNameChangePanel(),[3,5];case 3:return n=r.sent(),o=n&&n.message?n.message:"Failed to change name",this.showNameChangeError(o),[3,5];case 4:return this.nameChangeSubmitButton&&(this.nameChangeSubmitButton.interactable=!0),[7];case 5:return[2]}})})},t.prototype.showNameChangeError=function(e){this.nameChangeErrorLabel&&(this.nameChangeErrorLabel.string=e,this.nameChangeErrorLabel.node.active=!0)},t.prototype.setAuthButtonsEnabled=function(e){[this.signInButton,this.signUpButton,this.signInSubmitButton,this.signUpSubmitButton,this.signInCloseButton,this.signUpCloseButton,this.logoutButton].filter(Boolean).forEach(function(t){var n=t.getComponent(cc.Button);n&&(n.interactable=e)})},t.prototype.validateCredentials=function(e,t,n){return e?e.length>15?"Username must be at most 15 characters":e.length<6?"Username must be at least 6 characters":t.length<8?"Password must be at least 8 characters":t.length>15?"Password must be at most 15 characters":"string"==typeof n&&n!==t?"Passwords do not match":"":"Username is required"},i([u(cc.Node)],t.prototype,"gameListContent",void 0),i([u(cc.Prefab)],t.prototype,"gameCardPrefab",void 0),i([u(cc.Node)],t.prototype,"errorPanel",void 0),i([u(cc.Node)],t.prototype,"signInPanel",void 0),i([u(cc.Node)],t.prototype,"signUpPanel",void 0),i([u(cc.Node)],t.prototype,"signInButton",void 0),i([u(cc.Node)],t.prototype,"signUpButton",void 0),i([u(cc.Node)],t.prototype,"signInSubmitButton",void 0),i([u(cc.Node)],t.prototype,"signUpSubmitButton",void 0),i([u(cc.Node)],t.prototype,"signInCloseButton",void 0),i([u(cc.Node)],t.prototype,"signUpCloseButton",void 0),i([u(cc.Node)],t.prototype,"authGuestPanel",void 0),i([u(cc.Node)],t.prototype,"authUserPanel",void 0),i([u(cc.Label)],t.prototype,"lblProfileName",void 0),i([u(cc.Label)],t.prototype,"lblProfileBalance",void 0),i([u(cc.Node)],t.prototype,"logoutButton",void 0),i([u(cc.Node)],t.prototype,"nameChangePanel",void 0),i([u(cc.EditBox)],t.prototype,"nameChangeInput",void 0),i([u(cc.Button)],t.prototype,"nameChangeSubmitButton",void 0),i([u(cc.Label)],t.prototype,"nameChangeErrorLabel",void 0),i([u(cc.EditBox)],t.prototype,"signInUsername",void 0),i([u(cc.EditBox)],t.prototype,"signInPassword",void 0),i([u(cc.EditBox)],t.prototype,"signUpUsername",void 0),i([u(cc.EditBox)],t.prototype,"signUpPassword",void 0),i([u(cc.EditBox)],t.prototype,"signUpPasswordRe",void 0),i([u(cc.Toggle)],t.prototype,"signInShowPass",void 0),i([u(cc.Toggle)],t.prototype,"signUpShowPass",void 0),i([u(cc.Toggle)],t.prototype,"signUpShowPassRe",void 0),i([l],t)}(cc.Component);n.default=m,cc._RF.pop()},{"../core/AuthService":"AuthService","../core/ConfigService":"ConfigService","../core/EventBridge":"EventBridge","../core/PortalContextService":"PortalContextService","../game/GameCardController":"GameCardController"}],PortalContextService:[function(e,t,n){"use strict";cc._RF.push(t,"af83dml4eFIF4n0miCB64n7","PortalContextService"),Object.defineProperty(n,"__esModule",{value:!0}),n.PortalContextService=void 0;var o=e("../constants/StorageKeys"),r=function(){function e(){}return e.init=function(){localStorage.getItem(o.StorageKeys.ENVIRONMENT)||localStorage.setItem(o.StorageKeys.ENVIRONMENT,"dev"),localStorage.getItem(o.StorageKeys.ENVIRONMENT_LEGACY)||localStorage.setItem(o.StorageKeys.ENVIRONMENT_LEGACY,localStorage.getItem(o.StorageKeys.ENVIRONMENT)||"dev"),localStorage.getItem(o.StorageKeys.APP_LANGUAGE)||localStorage.setItem(o.StorageKeys.APP_LANGUAGE,"en"),localStorage.getItem(o.StorageKeys.ENABLE_SOUND)||localStorage.setItem(o.StorageKeys.ENABLE_SOUND,"1"),localStorage.getItem(o.StorageKeys.ENABLE_BGM)||localStorage.setItem(o.StorageKeys.ENABLE_BGM,"1");var e=this.getToken&&this.getToken();console.log("[Storage] Token:",e)},e.setEnvironment=function(e){localStorage.setItem(o.StorageKeys.ENVIRONMENT,e),localStorage.setItem(o.StorageKeys.ENVIRONMENT_LEGACY,e)},e.getEnvironment=function(){return localStorage.getItem(o.StorageKeys.ENVIRONMENT)||localStorage.getItem(o.StorageKeys.ENVIRONMENT_LEGACY)},e.setLanguage=function(e){localStorage.setItem(o.StorageKeys.APP_LANGUAGE,e)},e.getLanguage=function(){return localStorage.getItem(o.StorageKeys.APP_LANGUAGE)},e.setSoundEnabled=function(e){localStorage.setItem(o.StorageKeys.ENABLE_SOUND,e?"1":"0")},e.isSoundEnabled=function(){var e=localStorage.getItem(o.StorageKeys.ENABLE_SOUND);return"1"===e||"true"===e},e.setMarket=function(e){localStorage.setItem(o.StorageKeys.SELECTED_MARKET,e)},e.getMarket=function(){return localStorage.getItem(o.StorageKeys.SELECTED_MARKET)||"VN"},e.getCurrency=function(){return"VN"===this.getMarket()?"VND":"THB"},e.getAppId=function(){return this.getMarket(),"bc116112"},e.setToken=function(e){localStorage.setItem(o.StorageKeys.USER_TOKEN,e)},e.getToken=function(){return localStorage.getItem(o.StorageKeys.USER_TOKEN)},e.getSessionId=function(){return localStorage.getItem(o.StorageKeys.USER_SESSION_ID)||""},e.getGameApiBaseUrl=function(){return"undefined"!=typeof window&&window.location&&window.location.origin?window.location.origin+"/game":"/game"},e}();n.PortalContextService=r,cc._RF.pop()},{"../constants/StorageKeys":"StorageKeys"}],PortalEvents:[function(e,t,n){"use strict";cc._RF.push(t,"2437a/aYrxPV55VLiblch19","PortalEvents"),Object.defineProperty(n,"__esModule",{value:!0}),n.PortalEvents=void 0,n.PortalEvents={PORTAL_LAUNCH_GAME:"PORTAL_LAUNCH_GAME",BACK_TO_LOBBY:"INTEGRATION_BACK_TO_LOBBY",SHOW_POPUP:"MINI_GAME_SHOW_POPUP",UPDATE_SFX:"UPDATE_SFX_SETTING"},cc._RF.pop()},{}],RemoteBundleLoader:[function(e,t,n){"use strict";cc._RF.push(t,"4e9eakdxs5BzJwPANldPclW","RemoteBundleLoader");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o};Object.defineProperty(n,"__esModule",{value:!0});var i=e("../game/GameEntry"),a=e("../constants/PortalEvents"),s=cc._decorator.ccclass,c=function(){function e(){}return Object.defineProperty(e,"mode",{get:function(){return this._mode},enumerable:!1,configurable:!0}),e.loadGame=function(e,t,n,o){var r=this;return new Promise(function(t,i){var a=e;o&&o("Downloading..."),n&&n(0,1),cc.assetManager.loadBundle(a,function(e,s){if(e)return r.logLoadBundleError(a,e),void i(e);r._activeBundle=s,("undefined"!=typeof globalThis?globalThis:window).__ACTIVE_GAME_BUNDLE__=s,r.wrapBundleLoadWithContentFallback(s);var c=s,l=c._config||c.config||c._base||{};if(l.scenes&&(cc.log("[RemoteBundleLoader] config.scenes type:",typeof l.scenes,"isArray:",Array.isArray(l.scenes)),"object"==typeof l.scenes&&!Array.isArray(l.scenes))){var u=Object.keys(l.scenes);cc.log("[RemoteBundleLoader] config.scenes keys:",u)}o&&o("Loading..."),n&&n(1,10);var d=r.getBundleSceneNames(s),g=r.detectEntryScene(s);"_map"!==g&&"_count"!==g&&g||(g=null),g&&d.length>0&&-1===d.indexOf(g)&&-1===d.indexOf("[entryScene]"+g)&&(g=r.detectEntryScene(s));var f=function(e){if(!e){var a=d.length>0?"Could not resolve entry scene from bundle. Scenes: "+d.join(", "):"Could not resolve entry scene. Ensure the bundle includes scenes (prefer one named [entryScene]...).";return cc.error("[RemoteBundleLoader]",a),void i(new Error(a))}r._mode="scene";var c=r.resolveScenePath(s,e)||e,l=c&&"_map"!==c?c:null;cc.log("[RemoteBundleLoader] Mode:",r._mode,"validNames:",d.length,l?"scene="+l:""),l?r.preloadThenLaunchScene(s,l,n,o).then(t).catch(i):i(new Error("Could not resolve scene path for: "+e))};g?f(g):r.fetchEntrySceneFromConfigUrl(a).then(function(e){f(e)}).catch(function(e){cc.error("[RemoteBundleLoader] Config fetch failed:",e),i(new Error("Could not resolve entry scene. Ensure the bundle includes scenes (prefer one named [entryScene]...)."))})})})},e.preloadThenLaunchPrefab=function(e,t,n,o){var r=this;return new Promise(function(a,s){o&&o("Loading..."),e.preload("GameEntry",cc.Prefab,function(e,t){n&&t>0&&n(1+e/t*9,10)},function(o){if(o)return cc.error("[RemoteBundleLoader] Preload prefab failed",o),void s(o);n&&n(10,10),e.load("GameEntry",cc.Prefab,function(e,n){if(e)return cc.error("[RemoteBundleLoader] Entry prefab missing:","GameEntry"),void s(e);var o=cc.instantiate(n);o.getComponent(i.default)||(cc.log("[RemoteBundleLoader] Injecting GameEntry script automatically"),o.addComponent(i.default)),r.disableCanvasesInTree(o),o.parent=t,r._gameRoot=o,a()})})})},e.preloadThenLaunchScene=function(e,t,n,o){var r=this;return new Promise(function(i,a){t&&"_map"!==t?(o&&o("Loading scene..."),e.preloadScene(t,function(e,t){n&&t>0&&n(1+e/t*9,10)},function(s){if(s)return cc.error("[RemoteBundleLoader] Preload scene failed:",t,s),void a(s);n&&n(10,10),o&&o("Starting..."),e.loadScene(t,function(e,n){if(e)return cc.error("[RemoteBundleLoader] Scene not found in bundle:",t),void a(e);cc.director.runScene(n),cc.log("[RemoteBundleLoader] Scene launched:",t),setTimeout(function(){r.injectBackButton()},200),i()})})):a(new Error("Invalid scene name (_map); use auto-detect or a valid bundle scene."))})},e.wrapBundleLoadWithContentFallback=function(e){var t=function(e){return e&&-1!==String(e.message||e).indexOf("doesn't contain")},n=function(e){return e.startsWith("content/")?e:"content/"+e.replace(/^\//,"")},o=e.load.bind(e);e.load=function(e,i){for(var a=[],s=2;s<arguments.length;s++)a[s-2]=arguments[s];var c=a.length>0?a[a.length-1]:void 0,l=2===a.length?a[0]:void 0,u="function"==typeof c?c:void 0;if("string"!=typeof e||!u)return o.apply(void 0,r([e,i],a));var d=function(r,a){if(t(r)&&!e.startsWith("content/")){var s=n(e);cc&&cc.log&&cc.log("[RemoteBundleLoader] Retry load with content/ path:",s),l?o(s,i,l,function(e,t){return u(e,t)}):o(s,i,function(e,t){return u(e,t)})}else u(r,a)};l?o(e,i,l,d):o(e,i,d)};var i=e.preload.bind(e);e.preload=function(e,o){for(var a=[],s=2;s<arguments.length;s++)a[s-2]=arguments[s];var c=a.length>0?a[a.length-1]:void 0,l=2===a.length?a[0]:void 0,u="function"==typeof c?c:void 0;if("string"!=typeof e||!u)return i.apply(void 0,r([e,o],a));var d=function(r){if(t(r)&&!e.startsWith("content/")){var a=n(e);cc&&cc.log&&cc.log("[RemoteBundleLoader] Retry preload with content/ path:",a),l?i(a,o,l,function(e){return u(e)}):i(a,o,function(e){return u(e)})}else u(r)};l?i(e,o,l,d):i(e,o,d)}},e.unloadGame=function(){cc.log("[RemoteBundleLoader] Unloading game (mode:",this._mode+")"),cc.director.targetOff(this),"prefab"===this._mode&&this.destroyGameRoot();var e=this._activeBundle;this._activeBundle=null,this._mode="prefab",("undefined"!=typeof globalThis?globalThis:window).__ACTIVE_GAME_BUNDLE__=void 0,e&&this.deferredReleaseBundle(e)},e.deferredReleaseBundle=function(e){setTimeout(function(){try{e.releaseAll(),cc.assetManager.removeBundle(e)}catch(t){cc.warn("[RemoteBundleLoader] Bundle release error:",t)}},0)},e.destroyGameRoot=function(){this._gameRoot&&cc.isValid(this._gameRoot)&&(this._gameRoot.destroy(),this._gameRoot=null)},e.resolveScenePath=function(e,t){if(!t||"_map"===t)return null;var n=(t||"").replace(/\\/g,"/");if(0===n.indexOf("db://")||/\.(fire|scene)$/i.test(n))return t;var o=e,r=o._config||o.config||o._base||{};if(r.scenes&&"object"==typeof r.scenes)for(var i="function"==typeof r.scenes.keys?Array.from(r.scenes.keys()):Array.isArray(r.scenes)?[]:Object.keys(r.scenes),a=0;a<i.length;a++){var s=i[a];if("_map"!==s&&"_count"!==s&&((s||"").replace(/\\/g,"/").replace(/^.*\//,"").replace(/\.(fire|scene)$/i,"")||"")===t)return cc.log("[RemoteBundleLoader] Resolved scene path:",s),s}return null},e.getBundleSceneNames=function(e){var t=e,n=t._config||t.config||t._base||{};cc.log("[RemoteBundleLoader] ===== BUNDLE CONFIG DEBUG ====="),cc.log("[RemoteBundleLoader] raw keys:",Object.keys(t).slice(0,10)),cc.log("[RemoteBundleLoader] cfg exists:",!!n),cc.log("[RemoteBundleLoader] cfg.scenes exists:",!!n.scenes),cc.log("[RemoteBundleLoader] cfg.scenes type:",typeof n.scenes),cc.log("[RemoteBundleLoader] cfg.paths exists:",!!n.paths);var o=function(e){return(e||"").replace(/\\/g,"/").replace(/^.*\//,"").replace(/\.(fire|scene)$/i,"")||""},r=new Set,i=new Set(["_map","_count",""]);try{if(n.scenes&&"object"==typeof n.scenes&&"function"==typeof n.scenes.keys){var a=Array.from(n.scenes.keys());cc.log("[RemoteBundleLoader] config.scenes (Map) has",a.length,"keys"),a.forEach(function(e){var t=o(e);t&&!i.has(t)&&r.add(t)})}else n.scenes&&"object"==typeof n.scenes&&!Array.isArray(n.scenes)?(a=Object.keys(n.scenes),cc.log("[RemoteBundleLoader] config.scenes has",a.length,"keys"),a.forEach(function(e){var t=o(e);t&&!i.has(t)&&r.add(t)})):!n.scenes||Array.isArray(n.scenes);if(n.scenes&&Array.isArray(n.scenes)&&n.scenes.forEach(function(e){var t="string"==typeof e?e:e.url||e.path||"",n=o(t);n&&""!==n&&r.add(n)}),n.paths&&"object"==typeof n.paths){var s=0;Object.keys(n.paths).forEach(function(e){if(/\.(fire|scene)$/i.test(e)){s++;var t=o(e);t&&""!==t&&r.add(t)}}),cc.log("[RemoteBundleLoader] Found",s,"scene paths in cfg.paths")}var c=n.native;c&&c.scenes&&Array.isArray(c.scenes)&&c.scenes.forEach(function(e){var t="string"==typeof e?e:e.path||e.url||"",n=o(t);n&&""!==n&&r.add(n)})}catch(u){cc.error("[RemoteBundleLoader] Error parsing bundle config:",u)}var l=Array.from(r).filter(function(e){return!i.has(e)});return cc.log("[RemoteBundleLoader] getBundleSceneNames FINAL result:",l),cc.log("[RemoteBundleLoader] ===== END BUNDLE CONFIG DEBUG ====="),l},e.getScenePathsFromBundle=function(e){var t=e,n=t._config||t.config||t._base||{},o=[],r=function(e){return(e||"").replace(/\\/g,"/").replace(/^.*\//,"").replace(/\.(fire|scene)$/i,"")||""};try{n.scenes&&"object"==typeof n.scenes&&("function"==typeof n.scenes.keys?o.push.apply(o,Array.from(n.scenes.keys())):Array.isArray(n.scenes)||o.push.apply(o,Object.keys(n.scenes))),0===o.length&&n.paths&&"object"==typeof n.paths&&Object.keys(n.paths).forEach(function(e){/\.(fire|scene)$/i.test(e)&&o.push(e)})}catch(i){cc.error("[RemoteBundleLoader] getScenePathsFromBundle error:",i)}return o.filter(function(e){return e&&"_map"!==r(e)&&"_count"!==r(e)})},e.detectEntryScene=function(e){var t=this.getBundleSceneNames(e).filter(function(e){return"_map"!==e&&"_count"!==e});if(t.length>0){var n=t.find(function(e){return e.startsWith("[entryScene]")});if(n)return cc.log("[RemoteBundleLoader] Auto-detected entry scene (marked):",n,"available:",t),n;var o=t.find(function(e){return/game|main|play/i.test(e)&&!/loading/i.test(e)})||t[0];return cc.log("[RemoteBundleLoader] Auto-detected entry scene:",o,"available:",t),o}var r=this.getScenePathsFromBundle(e);if(r.length>0){var i=r.find(function(e){return(t=e,(t||"").replace(/\\/g,"/").replace(/^.*\//,"").replace(/\.(fire|scene)$/i,"")||"").startsWith("[entryScene]");var t})||r[0];return cc.log("[RemoteBundleLoader] Auto-detected entry scene from paths (fallback):",i),i}return cc.warn("[RemoteBundleLoader] No valid scenes found in bundle config"),null},e.fetchEntrySceneFromConfigUrl=function(e){var t=(e||"").replace(/\/*$/,"")+"/config.json";return cc.log("[RemoteBundleLoader] Fetching config from",t),new Promise(function(e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="json",n.onload=function(){if(200!==n.status)return cc.warn("[RemoteBundleLoader] Config fetch failed:",n.status,t),void e(null);var o=("object"==typeof n.response&&null!==n.response?n.response:{}).scenes;if(!o||"object"!=typeof o||Array.isArray(o))return cc.warn("[RemoteBundleLoader] Config has no scenes object"),void e(null);var r="function"==typeof o.keys?Array.from(o.keys()):Object.keys(o),i=function(e){return(e||"").replace(/\\/g,"/").replace(/^.*\//,"").replace(/\.(fire|scene)$/i,"")||""},a=r.filter(function(e){return e&&"_map"!==i(e)&&"_count"!==i(e)});if(0===a.length)return cc.warn("[RemoteBundleLoader] Config scenes list empty"),void e(null);var s=a.find(function(e){return i(e).startsWith("[entryScene]")})||a[0];cc.log("[RemoteBundleLoader] Entry scene from config.json:",s,"available:",a.length),e(s)},n.onerror=function(){cc.warn("[RemoteBundleLoader] Config fetch error:",t),e(null)},n.send()})},e.injectBackButton=function(){var e=cc.director.getScene();if(e){var t=null;e.children.forEach(function(e){!t&&e.getComponent(cc.Canvas)&&(t=e)});var n=t||e,o=new cc.Node("__PortalBackBtn__");o.zIndex=9999,o.setContentSize(120,40),o.setAnchorPoint(0,1),o.parent=n;var r=o.addComponent(cc.Widget);r.isAlignTop=!0,r.isAlignLeft=!0,r.top=10,r.left=10,r.alignMode=cc.Widget.AlignMode.ON_WINDOW_RESIZE,r.updateAlignment();var i=o.addComponent(cc.Graphics);i.fillColor=new cc.Color(0,0,0,180),i.roundRect(0,-40,120,40,8),i.fill();var s=new cc.Node("Label");s.setContentSize(120,40),s.setAnchorPoint(.5,.5),s.setPosition(60,-20),s.color=cc.Color.WHITE,s.parent=o;var c=s.addComponent(cc.Label);c.string="< LOBBY",c.fontSize=20,c.lineHeight=40,c.horizontalAlign=cc.Label.HorizontalAlign.CENTER,c.verticalAlign=cc.Label.VerticalAlign.CENTER,o.on(cc.Node.EventType.TOUCH_END,function(){cc.log("[RemoteBundleLoader] Back button pressed (scene mode)"),cc.director.emit(a.PortalEvents.BACK_TO_LOBBY)}),cc.log("[RemoteBundleLoader] Injected back button into game scene")}},e.disableCanvasesInTree=function(e){var t=e.getComponent(cc.Canvas);t&&(t.enabled=!1);for(var n=0;n<e.children.length;n++)this.disableCanvasesInTree(e.children[n])},e.logLoadBundleError=function(e,t){var n=t&&t.message?t.message:String(t);n.includes("403")||n.includes("Forbidden")?cc.error("[RemoteBundleLoader] Bundle load failed: 403 Forbidden\nCheck server permissions/CORS for:\n- "+e+"config.json\n- "+e+"index.js"):n.includes("404")||n.includes("Not Found")?cc.error("[RemoteBundleLoader] Bundle not found:",e):cc.error("[RemoteBundleLoader] Bundle load failed:",t)},e._activeBundle=null,e._gameRoot=null,e._mode="prefab",o([s],e)}();n.default=c,cc._RF.pop()},{"../constants/PortalEvents":"PortalEvents","../game/GameEntry":"GameEntry"}],StorageKeys:[function(e,t,n){"use strict";cc._RF.push(t,"6b418dJ25xDybseDK2DpwOW","StorageKeys"),Object.defineProperty(n,"__esModule",{value:!0}),n.StorageKeys=void 0,n.StorageKeys={USER_TOKEN:"user_token",USER_SESSION_ID:"user_session_id",AUTH_USER:"auth_user",AUTH_USERS:"auth_users",AUTH_FINGERPRINT:"auth_fingerprint",AUTH_PROFILE:"auth_profile",ENVIRONMENT:"environment",ENVIRONMENT_LEGACY:"enviroment",APP_LANGUAGE:"appLanguage",ENABLE_SOUND:"enableSound",ENABLE_BGM:"enableBackgroundMusic",FORCE_MOCK_GAME:"forceMockGame",BASE_URL:"base_url",SELECTED_MARKET:"selected_market"},cc._RF.pop()},{}]},{},["Config","PortalEvents","StorageKeys","AuthService","ConfigService","EventBridge","PortalContextService","RemoteBundleLoader","GameCardController","GameEntry","GameHostUIController","LobbyUIController"]);